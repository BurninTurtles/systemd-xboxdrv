#!/bin/sh
# xboxdrv-pre
# Please, DO NOT EDIT THIS FILE. Edit /etc/defaults/xboxdrv

# Edit /etc/default/xboxdrv to change these options
FORCE_FEEDBACK=false
MIMIC_XPAD=true
TRIGGER_AS_BUTTON=true
XBOXDRV_OPTIONS=""

CONTROLLER0_OPTIONS=""
CONTROLLER1_OPTIONS=""
CONTROLLER2_OPTIONS=""
CONTROLLER3_OPTIONS=""

CONTROLLER0=""
CONTROLLER1=""
CONTROLLER2=""
CONTROLLER3=""
# Read configuration variable file if it is present
if [ -f /etc/default/xboxdrv ] ; then
    . /etc/default/xboxdrv
fi
# This will store all pad options from /etc/default/xboxdrv
PAD_OPTIONS=""
# Checking if user has enabled forcefeedback
if [ "$FORCE_FEEDBACK" = true ] ; then
    PAD_OPTIONS="$PAD_OPTIONS --force-feedback"
fi
# Checking if user has enabled mimic_xpad
if [ "$MIMIC_XPAD" = true ] ; then
    PAD_OPTIONS="$PAD_OPTIONS --mimic-xpad --mimic-xpad-wireless"
fi
# Checking if user is using trigger as buttons instead of zaxis
if [ "$TRIGGER_AS_BUTTON" = true ] ; then
    PAD_OPTIONS="$PAD_OPTIONS --trigger-as-button"
fi
# Adding --detach-kernel-driver
PAD_OPTIONS="$PAD_OPTIONS --detach-kernel-driver"
# xboxdrv --daemon --silent --dbus disabled $XBOXDRV_OPTIONS $PAD_OPTIONS $CONTROLLER0_OPTIONS --next-controller $PAD_OPTIONS $CONTROLLER1_OPTIONS --next-controller $PAD_OPTIONS $CONTROLLER2_OPTIONS--next-controller $PAD_OPTIONS $CONTROLLER3_OPTIONS

mkdir -p /var/run/xboxdrv/profiles
mkdir -p /var/run/xboxdrv/running
if [ -n "$CONTROLLER0" ] ; then
    echo XBOXDRV_OPTIONS="$XBOXDRV_OPTIONS" > /run/xboxdrv/profiles/$CONTROLLER0
    echo CONTROLLER_OPTIONS="$CONTROLLER0_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER0
    echo PAD_OPTIONS="$PAD_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER0
fi
if [ -n "$CONTROLLER1" ] ; then
    echo XBOXDRV_OPTIONS="$XBOXDRV_OPTIONS" > /run/xboxdrv/profiles/$CONTROLLER1
    echo CONTROLLER_OPTIONS="$CONTROLLER1_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER1
    echo PAD_OPTIONS="$PAD_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER1
fi
if [ -n "$CONTROLLER2" ] ; then
    echo XBOXDRV_OPTIONS="$XBOXDRV_OPTIONS" > /run/xboxdrv/profiles/$CONTROLLER2
    echo CONTROLLER_OPTIONS="$CONTROLLER2_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER2
    echo PAD_OPTIONS="$PAD_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER2
fi
if [ -n "$CONTROLLER3" ] ; then
    echo XBOXDRV_OPTIONS="$XBOXDRV_OPTIONS" > /run/xboxdrv/profiles/$CONTROLLER3
    echo CONTROLLER_OPTIONS="$CONTROLLER3_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER3
    echo PAD_OPTIONS="$PAD_OPTIONS" >> /run/xboxdrv/profiles/$CONTROLLER3
fi
cp /run/xboxdrv/uxvars /usr/share/ubuntu-xboxdrv/uxvars.bak
echo XBOXDRV_OPTIONS="$XBOXDRV_OPTIONS" > /run/xboxdrv/uxvars
echo CONTROLLER0_OPTIONS="$CONTROLLER0_OPTIONS" >> /run/xboxdrv/uxvars
echo CONTROLLER1_OPTIONS="$CONTROLLER1_OPTIONS" >> /run/xboxdrv/uxvars
echo CONTROLLER2_OPTIONS="$CONTROLLER2_OPTIONS" >> /run/xboxdrv/uxvars
echo CONTROLLER3_OPTIONS="$CONTROLLER3_OPTIONS" >> /run/xboxdrv/uxvars
echo PAD_OPTIONS="$PAD_OPTIONS" >> /run/xboxdrv/uxvars

echo CONTROLLER0="$CONTROLLER0" > /run/xboxdrv/controllers
echo CONTROLLER1="$CONTROLLER1" >> /run/xboxdrv/controllers
echo CONTROLLER2="$CONTROLLER2" >> /run/xboxdrv/controllers
echo CONTROLLER3="$CONTROLLER3" >> /run/xboxdrv/controllers
